var sane = require('./index');
var fs = require('fs');
var path = require('path');
var assert = require('assert');
var watcher1;
var watcher2;
var tmpdir = __dirname;;
var jo = path.join.bind(path);
var testdir = jo(tmpdir, 'sublimeroot');
var testdir2 = jo(tmpdir, 'sublimeroot', 'sub1');
try {
    fs.mkdirSync(testdir);
} catch (e) {};
try {
    fs.mkdirSync(testdir2);
} catch (e) {};
try {
    fs.mkdirSync(testdir3);
} catch (e) {};

watcher1 = new sane.Watcher(testdir, {
    poll: false
});
watcher2 = new sane.Watcher(testdir2, {
    poll: false
});

watcher1.on('change', function(e) {
    console.log("w1", e);
});
watcher2.on('change', function(e) {
    console.log("w2", e);
});

console.log("Watching ", testdir2, " twice. Changing a file in this directory with sublime (on windows only ?) will cause an error.");